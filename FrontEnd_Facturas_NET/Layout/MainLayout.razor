@inherits LayoutComponentBase
@inject CarritoService CarritoService
@inject NavigationManager Navigation
@implements IDisposable

<MudLayout>
    <MudAppBar Elevation="3" Style="background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%);">
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="d-flex align-center">
            <MudIcon Icon="@Icons.Material.Filled.Store" Size="Size.Large" Class="mr-2" />
            <MudText Typo="Typo.h5" Style="font-weight: bold; color: #ffd700;">Tienda RICO - NET</MudText>
            <MudSpacer />
            <NavMenu />
            <MudBadge Content="@_cantidadCarrito" Color="Color.Warning" Overlap="true" Class="ml-4">
                <MudIconButton Icon="@Icons.Material.Filled.ShoppingCart" Style="color: white;" OnClick="@(() => Navigation.NavigateTo("/carrito"))" />
            </MudBadge>
        </MudContainer>
    </MudAppBar>

    <MudMainContent Style="background-color: #f5f5f5; min-height: 100vh;">
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="py-6">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    private int _cantidadCarrito = 0;

    protected override void OnInitialized()
    {
        CarritoService.OnChange += ActualizarCarrito;
        ActualizarCarrito();
    }

    private void ActualizarCarrito()
    {
        _cantidadCarrito = CarritoService.ObtenerCantidadTotal();
        StateHasChanged();
    }

    public void Dispose()
    {
        CarritoService.OnChange -= ActualizarCarrito;
    }
}
